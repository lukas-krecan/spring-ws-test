<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at May 8, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Server test support</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20130508" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="./" id="bannerLeft">
                Spring WS Test
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2013-05-08</span>
                  &nbsp;| <span id="projectVersion">Version: 0.23-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="../jira/browse/SWST" title="JIRA">JIRA</a>
            |
                        <a href="http://static.springsource.org/spring-ws/sites/1.5/" class="externalLink" title="Spring WS">Spring WS</a>
              
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Spring WS Test</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="client-tutorial.html" title="Client Test Tutorial">Client Test Tutorial</a>
            </li>
                  <li class="none">
                          <a href="unit-test-support.html" title="Advanced Client Unit Tests">Advanced Client Unit Tests</a>
            </li>
                  <li class="none">
            <strong>Server test support</strong>
          </li>
                  <li class="none">
                          <a href="func-test.html" title="Functional tests">Functional tests</a>
            </li>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="reference.html" title="Reference">Reference</a>
            </li>
                  <li class="none">
                          <a href="naq.html" title="N.A.Q">N.A.Q</a>
            </li>
                  <li class="none">
                          <a href="sample.html" title="Sample app">Sample app</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                        <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                                                                                                                   <a href="http://maven.apache.org/" title="Maven" class="poweredBy">
        <img class="poweredBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                       
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!--  --><!-- Copyright 2009-2010 the original author or authors. --><!--  --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!--  --><!--  --><!-- Copyright 2006 the original author or authors. --><!--  --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!--  --><div class="section"><h2>Server test support<a name="Server_test_support"></a></h2><p>Spring WS Test provides you a helper class to simplify server side tests. </p><p>Code shown here is taken from server test sample application, which can be viewed <a class="externalLink" href="https://java-crumbs.svn.sourceforge.net/svnroot/java-crumbs/simple-server-test/tags/simple-server-test-0.22/simple-server-test/">in SVN repository</a>.</p><p>It's possible to download it using following command <tt>svn co https://java-crumbs.svn.sourceforge.net/svnroot/java-crumbs/simple-server-test/tags/simple-server-test-0.22/simple-server-test/ simple-server-test</tt></p><div class="section"><h3>Simple test <a name="Simple_test"></a></h3><p>If you want to test your server-side Web Service configuration, you can do something like this:</p><div><pre>@RunWith(SpringJUnit4ClassRunner.class)
// your endpoint configuration + Default helper config
@ContextConfiguration(locations = { &quot;file:src/main/webapp/WEB-INF/spring-ws-servlet.xml&quot;,
                WsTestHelper.DEFAULT_CONFIG_PATH })
public class EndpointTest {

        @Autowired
        private WsTestHelper helper;

        @Test
        public void testSimple() throws Exception {
                // simulates request coming to MessageDispatcherServlet
                MessageContext message = helper.receiveMessage(&quot;request1.xml&quot;);
                // assert that response is not fault
                helper.createMessageValidator(message.getResponse()).assertNotSoapFault();
        }
        
        @Test
        public void testCompare() throws Exception {
                // simulates request coming to MessageDispatcherServlet
                MessageContext message = helper.receiveMessage(&quot;request1.xml&quot;);
                // compare response with control response
                helper.createMessageValidator(message.getResponse()).assertNotSoapFault().compare(&quot;response1.xml&quot;);
        }
}</pre></div><p>This test loads <tt>request1.xml</tt> and simulates that its content came as a SOAP request. Tested application processes the request and returns a response. The response can be either just validated that it does not contain error or it can be compared with expected value. In the example above the response is compared to <tt>response1.xml</tt>.</p><p>Both request and response can be defined as payload only. If the message does not contain SOAP envelope, the message is automatically wrapped to one.</p><p>Please note, that you do not have to start servlet engine. The test can run as normal unit test. Web.xml is ignored, if you have multiple servlets to test, it's possible to write multiple test classes each of them using configuration for given servlet. </p></div><div class="section"><h3>Response validation<a name="Response_validation"></a></h3><p>It's also possible to use more sophisticated validation assertions </p><div><pre>        @Test
        public void testAssertXPath() throws Exception {
                // simulates request coming to MessageDispatcherServlet
                MessageContext message = helper.receiveMessage(&quot;request1.xml&quot;);
                //validate response
                helper.createMessageValidator(message.getResponse()).assertNotSoapFault().validate(&quot;xsd/calc.xsd&quot;)
                        .addNamespaceMapping(&quot;ns&quot;, &quot;http://javacrumbs.net/calc&quot;).assertXPath(&quot;//ns:result=3&quot;);
        }</pre></div></div><div class="section"><h3>Templates<a name="Templates"></a></h3><p>It is possible to use templates for both request and response. One possible example can look like this.</p><div><pre>@Test
public void testResponseTemplate() throws Exception {
        WsTestContextHolder.getTestContext().setAttribute(&quot;a&quot;, 1);
        WsTestContextHolder.getTestContext().setAttribute(&quot;b&quot;, 2);
        WsTestContextHolder.getTestContext().setAttribute(&quot;result&quot;, 3);
        // simulates request coming to MessageDispatcherServlet
        MessageContext message = helper.receiveMessage(&quot;request-context-xslt.xml&quot;);
        // compare response with control response
        helper.createMessageValidator(message.getResponse()).assertNotSoapFault().compare(&quot;response-context-xslt.xml&quot;);
        
        WsTestContextHolder.getTestContext().clear();
}</pre></div><p>Corresponding template (request-context-xslt.xml):</p><div><pre>&lt;xsl:stylesheet xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; version=&quot;1.0&quot;&gt;
        &lt;xsl:param name=&quot;a&quot; /&gt;
        &lt;xsl:param name=&quot;b&quot; /&gt;
        &lt;xsl:template match=&quot;/&quot;&gt;
                &lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
                        &lt;soapenv:Header /&gt;
                        &lt;soapenv:Body&gt;
                                &lt;plusRequest xmlns=&quot;http://javacrumbs.net/calc&quot;&gt;
                                        &lt;a&gt;&lt;xsl:value-of select=&quot;$a&quot; /&gt;&lt;/a&gt;
                                        &lt;b&gt;&lt;xsl:value-of select=&quot;$b&quot; /&gt;&lt;/b&gt;
                                &lt;/plusRequest&gt;
                        &lt;/soapenv:Body&gt;
                &lt;/soapenv:Envelope&gt;
        &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre></div></div><div class="section"><h3>Alternative configuration<a name="Alternative_configuration"></a></h3><p>It is possible to change the default WsTestHelper configuration. It's just necessary to write standard Spring configuration file and use it instead of <tt>WsTestHelper.DEFAULT_CONFIG_PATH</tt>. Here is an example of using FreeMarker templating engine.</p><div><pre>@RunWith(SpringJUnit4ClassRunner.class)
// your endpoint configuration + alternative helper config
@ContextConfiguration(locations = { &quot;file:src/main/webapp/WEB-INF/spring-ws-servlet.xml&quot;,
                &quot;classpath:spring/alternative-helper-config.xml&quot; })
public class AlternativeEndpointTest {

        @Autowired
        private WsTestHelper helper;

        @Test
        public void testSimple() throws Exception {
                // simulates request coming to MessageDispatcherServlet
                MessageContext message = helper.receiveMessage(&quot;request1.xml&quot;);
                // compare response with control response
                helper.createMessageValidator(message.getResponse()).compare(&quot;response1.xml&quot;);
        }
}</pre></div><p>The corresponding configuration file (<tt>alternative-helper-config.xml</tt>) looks like this.</p><div><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;

        &lt;bean class=&quot;net.javacrumbs.springws.test.helper.DefaultWsTestHelper&quot;&gt;
                &lt;property name=&quot;templateProcessor&quot;&gt;
                        &lt;bean class=&quot;net.javacrumbs.springws.test.template.FreeMarkerTemplateProcessor&quot;/&gt;
                &lt;/property&gt;
        &lt;/bean&gt;

&lt;/beans&gt;</pre></div></div><div class="section"><h3>WebServiceTemplate test<a name="WebServiceTemplate_test"></a></h3><p>It's not necessary to use WsTestHelper for the test. It's also possible to use <tt>WebServiceTemplate</tt>. In order to do this, you have to configure it</p><div><pre>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;

        &lt;bean id=&quot;marshaller&quot; class=&quot;org.springframework.oxm.jaxb.Jaxb2Marshaller&quot;&gt;
                &lt;property name=&quot;contextPath&quot; value=&quot;net.javacrumbs.calc.model&quot; /&gt;
        &lt;/bean&gt;

        &lt;bean id=&quot;webServiceTemplate&quot; class=&quot;org.springframework.ws.client.core.WebServiceTemplate&quot;&gt;
                &lt;property name=&quot;marshaller&quot; ref=&quot;marshaller&quot;/&gt;
                &lt;property name=&quot;unmarshaller&quot; ref=&quot;marshaller&quot;/&gt;
                &lt;property name=&quot;defaultUri&quot; value=&quot;http://localhost&quot;/&gt;
                &lt;property name=&quot;messageSender&quot;&gt;
                        &lt;bean class=&quot;net.javacrumbs.springws.test.helper.InMemoryWebServiceMessageSender&quot;/&gt;
                &lt;/property&gt;
        &lt;/bean&gt;
        
&lt;/beans&gt;</pre></div><p>Then, you can write test as normal Spring WS client. For example:</p><div><pre>@RunWith(SpringJUnit4ClassRunner.class)
// your endpoint configuration + extended config
@ContextConfiguration(locations = { &quot;file:src/main/webapp/WEB-INF/spring-ws-servlet.xml&quot;,
                &quot;classpath:spring/marshalling-helper-config.xml&quot; })
public class MarshallingEndpointTest {

        @Autowired
        private WebServiceOperations wsTemplate;
        
        @Test
        public void testSimple() throws Exception {
                PlusRequest request = new PlusRequest();
                request.setA(1);
                request.setB(2);
                
                PlusResponse response = (PlusResponse) wsTemplate.marshalSendAndReceive(request);
                // assert that response is not fault
                assertEquals(3, response.getResult());
        }
        @Test
        public void testError() throws Exception {
                PlusRequest request = new PlusRequest();
                request.setA(Integer.MAX_VALUE);
                request.setB(2);
                
                try
                {
                        wsTemplate.marshalSendAndReceive(request);
                        fail(&quot;Exception expected&quot;);
                }
                catch(SoapFaultClientException e)
                {
                        assertEquals(&quot;Values are too big.&quot;,e.getSoapFault().getFaultStringOrReason());
                        //or an alternative error validation 
                        new MessageValidator(e.getWebServiceMessage()).assertSoapFault().assertFaultStringOrReason(&quot;Values are too big.&quot;);
                }

        }
}</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2013.
          All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
